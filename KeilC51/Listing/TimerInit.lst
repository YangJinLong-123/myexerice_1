C51 COMPILER V9.52.0.0   TIMERINIT                                                         04/16/2020 10:07:51 PAGE 1   


C51 COMPILER V9.52.0.0, COMPILATION OF MODULE TIMERINIT
OBJECT MODULE PLACED IN .\Output\TimerInit.obj
COMPILER INVOKED BY: D:\Keil4\C51\BIN\C51.EXE ..\User\Source\Hardware\TimerInit.c LARGE OMF2 WARNINGLEVEL(0) OPTIMIZE(5,
                    -SPEED) BROWSE INCDIR(..\Library\FU68xx_Hardware_Driver\Include;..\User\Include) DEBUG PRINT(.\Listing\TimerInit.lst) TAB
                    -S(2) OBJECT(.\Output\TimerInit.obj)

line level    source

   1          /**************************** (C) COPYRIGHT 2017 Fortiortech shenzhen *****************************
   2          * File Name          : TimerInit.c
   3          * Author             : Fortiortech  Appliction Team
   4          * Version            : V1.0
   5          * Date               : 10-Apr-2017
   6          * Description        : This file contains Timer Initial function used for Motor Control.
   7          ***************************************************************************************************
   8          * All Rights Reserved
   9          **************************************************************************************************/
  10          
  11          
  12          /* Includes -------------------------------------------------------------------------------------*/
  13          #include <FU68xx_2.h>
  14          #include <Myproject.h>
  15          
  16          /* Private variables ----------------------------------------------------------------------------*/
  17          
  18          
  19          /*-------------------------------------------------------------------------------------------------
  20            Function Name : void TIM0_Init(void)
  21            Description   : TIM0ÂàùÂßãÂåñÈÖçÁΩÆ
  22            Input         : Êó†
  23            Output        : Êó†
  24          -------------------------------------------------------------------------------------------------*/
  25          void TIM0_Init(void)
  26          {
  27   1      
  28   1      
  29   1      }
  30          
  31          /*-------------------------------------------------------------------------------------------------
  32            Function Name : void TIM1_Init(void)
  33            Description   : TIM1ÂàùÂßãÂåñÈÖçÁΩÆ
  34            Input         : Êó†
  35            Output        : Êó†
  36          -------------------------------------------------------------------------------------------------*/
  37          void TIM1_Init(void)
  38          {
  39   1         
  40   1      
  41   1      }
  42          
  43          /*-------------------------------------------------------------------------------------------------
  44            Function Name : void TIM2_Init(void)
  45            Description   : TIM2ÂàùÂßãÂåñÈÖçÁΩÆ
  46            Input         : Êó†
  47            Output        : Êó†
  48          -------------------------------------------------------------------------------------------------*/
  49          void TIM2_Init(void)
  50          {
  51   1          /*-------------------------------------------------------------------------------------------------
  52   1          ÂÖàÂÅúÊ≠¢ËÆ°Êï∞ÔºåÈÖçÁΩÆÂÆåÂØÑÂ≠òÂô®ÂêéÔºåÊúÄÂêéÂêØÂä®ËÆ°Êï∞
  53   1        -------------------------------------------------------------------------------------------------*/
C51 COMPILER V9.52.0.0   TIMERINIT                                                         04/16/2020 10:07:51 PAGE 2   

  54   1          ClrBit(TIM2_CR1, T2EN);                                // 0ÔºåÂÅúÊ≠¢ËÆ°Êï∞Ôºõ1,‰ΩøËÉΩËÆ°Êï∞
  55   1      
  56   1        /*-------------------------------------------------------------------------------------------------
  57   1          Êó∂ÈíüÂàÜÈ¢ëËÆæÁΩÆ(T2PSC)
  58   1          000:cpuclk(24MHz)     001:cpuclk/2^1(12MHz) 010:cpuclk/2^2(6MHz)  011:cpuclk/2^3(3MHz)
  59   1          100:cpuclk/2^4(1.5MHz)  101:cpuclk/2^5(750KHz)  110:cpuclk/2^6(375KHz)  111:cpuclk/2^7(187.5KHz)
  60   1        -------------------------------------------------------------------------------------------------*/
  61   1      //    SetReg(TIM2_CR0, T2PSC0 | T2PSC1 | T2PSC2, T2PSC0 | T2PSC1 | T2PSC2);
  62   1          ClrBit(TIM2_CR0, T2PSC0);
  63   1          ClrBit(TIM2_CR0, T2PSC1);
  64   1          ClrBit(TIM2_CR0, T2PSC2);
  65   1          
  66   1          /*-------------------------------------------------------------------------------------------------
  67   1          /Ê®°ÂºèÈÄâÊã©
  68   1          T2MODE1ÔºåT2MODE0
  69   1          00--ËæìÂÖ•TimerÊ®°ÂºèÔºõ01--ËæìÂá∫Ê®°Âºè
  70   1          10--ËæìÂÖ•CountÊ®°ÂºèÔºõ11--QEPÊàñËÄÖRSDÊ®°Âºè
  71   1        -------------------------------------------------------------------------------------------------*/
  72   1      //    SetReg(TIM2_CR0, T2MOD0 | T2MOD1, T2MOD0);
  73   1          ClrBit(TIM2_CR0, T2MOD0);
  74   1          ClrBit(TIM2_CR0, T2MOD1);
  75   1          /*-------------------------------------------------------------------------------------------------
  76   1          Ê∏ÖÈô§‰∏≠Êñ≠Ê†áÂøó‰Ωç
  77   1          Á¶ÅÊ≠¢PWMÂë®ÊúüÊ£ÄÊµã‰∏≠Êñ≠‰ΩøËÉΩ
  78   1          ‰ΩøËÉΩËÆ°Êï∞Âô®‰∏äÊ∫¢‰∏≠Êñ≠‰ΩøËÉΩ
  79   1        -------------------------------------------------------------------------------------------------*/
  80   1          ClrBit(TIM2_CR0, T2CES);                           // Ê∏ÖÈõ∂ËÑâÂÜ≤ËÆ°Êï∞Âô®‰∏ç‰ΩøËÉΩ
  81   1          ClrBit(TIM2_CR1, T2IR | T2IF | T2IP);              // Ê∏ÖÈõ∂‰∏≠Êñ≠Ê†áÂøó‰Ωç
  82   1      
  83   1          SetBit(TIM2_CR1, T2IFE);                               //‰∏äÊ∫¢‰∏≠Êñ≠‰ΩøËÉΩ
  84   1        /*-------------------------------------------------------------------------------------------------
  85   1          ÈÖçÁΩÆÂë®ÊúüÂÄº„ÄÅÊØîËæÉÂÄº„ÄÅËÆ°Êï∞ÂÄº
  86   1          Á¶ÅÊ≠¢PWMÂë®ÊúüÊ£ÄÊµã‰∏≠Êñ≠‰ΩøËÉΩ
  87   1          ‰ΩøËÉΩËÆ°Êï∞Âô®‰∏äÊ∫¢‰∏≠Êñ≠‰ΩøËÉΩ
  88   1        -------------------------------------------------------------------------------------------------*/
  89   1          TIM2__ARR = 24000;                                         // cpuclk(24MHz) ‰∏∫1Ms‰∏äÊ∫¢‰∏≠Êñ≠
  90   1          TIM2__DR = TIM2__ARR;
  91   1          TIM2__CNTR = 0;
  92   1        /*-----------ÂêØÂä®ËÆ°Êï∞------------------------------------------------*/
  93   1          SetBit(TIM2_CR1, T2EN);                              //ÂêØÂä®ËÆ°Êï∞
  94   1        
  95   1      }
  96          
  97          /*-------------------------------------------------------------------------------------------------
  98            Function Name : void TIM3_Init(void)
  99            Description   : TIM3ÂàùÂßãÂåñÈÖçÁΩÆ
 100            Input         : Êó†
 101            Output        : Êó†
 102          -------------------------------------------------------------------------------------------------*/
 103          void TIM3_Init(void)
 104          {
 105   1      /*-------------------------------------------------------------------------------------------------
 106   1        ÂÖàÂÅúÊ≠¢ËÆ°Êï∞ÔºåÈÖçÁΩÆÂÆåÂØÑÂ≠òÂô®ÂêéÔºåÊúÄÂêéÂêØÂä®ËÆ°Êï∞
 107   1      -------------------------------------------------------------------------------------------------*/
 108   1        ClrBit(TIM3_CR1, T3EN);       // 0-ÂÅúÊ≠¢ËÆ°Êï∞Ôºõ1-‰ΩøËÉΩËÆ°Êï∞
 109   1      //  SetBit(PH_SEL, T3SEL);        //0-‰∏çËøûÊé•Âà∞Á´ØÂè£GP11Ôºõ1-ËøûÊé•Âà∞Á´ØÂè£GP11
 110   1      /*-------------------------------------------------------------------------------------------------
 111   1        Êó∂ÈíüÂàÜÈ¢ëËÆæÁΩÆ(T2PSC)
 112   1        000:cpuclk(24MHz)     001:cpuclk/2^1(12MHz) 010:cpuclk/2^2(6MHz)  011:cpuclk/2^3(3MHz)
 113   1        100:cpuclk/2^4(1.5MHz)  101:cpuclk/2^5(750KHz)  110:cpuclk/2^6(375KHz)  111:cpuclk/2^7(187.5KHz)
 114   1      -------------------------------------------------------------------------------------------------*/
 115   1        SetReg(TIM3_CR0,  T3PSC1 | T3PSC0,  T3PSC1 | T3PSC0);
C51 COMPILER V9.52.0.0   TIMERINIT                                                         04/16/2020 10:07:51 PAGE 3   

 116   1      
 117   1      /*-------------------------------------------------------------------------------------------------
 118   1        /Ê®°ÂºèÈÄâÊã©
 119   1        0-ËæìÂÖ•Ê®°Âºè
 120   1        1-ËæìÂá∫Ê®°Âºè
 121   1      -------------------------------------------------------------------------------------------------*/
 122   1        SetBit(TIM3_CR0, T3MOD);  
 123   1        
 124   1        ClrBit(TIM3_CR0, T3OCM);  
 125   1        
 126   1      /*-------------------------------------------------------------------------------------------------
 127   1        /Êª§Ê≥¢Êó∂Èó¥
 128   1        00-‰∏çÊª§Ê≥¢Ôºõ01-8‰∏™Êó∂ÈíüÂë®Êúü
 129   1        10-16‰∏™Êó∂ÈíüÂë®ÊúüÔºõ11-32‰∏™Êó∂ÈíüÂë®Êúü
 130   1      -------------------------------------------------------------------------------------------------*/
 131   1        SetReg(TIM3_CR1, T3FE1|T3FE0,T3FE0);                               
 132   1      /*-------------------------------------------------------------------------------------------------
 133   1        Ê∏ÖÈô§‰∏≠Êñ≠Ê†áÂøó‰Ωç
 134   1        Á¶ÅÊ≠¢PWMÂë®ÊúüÊ£ÄÊµã‰∏≠Êñ≠‰ΩøËÉΩ
 135   1        ‰ΩøËÉΩËÆ°Êï∞Âô®‰∏äÊ∫¢‰∏≠Êñ≠‰ΩøËÉΩ
 136   1      -------------------------------------------------------------------------------------------------*/
 137   1        ClrBit(TIM3_CR1, T3IR | T3IF | T3IP);                      // Ê∏ÖÈô§‰∏≠Êñ≠Ê†áÂøó‰Ωç
 138   1        SetBit(TIM3_CR1, T3IFE );                                 // ËæìÂÖ•ÊúâÊïàËæπÊ≤øÂèòÂåñ‰∏≠Êñ≠‰ΩøËÉΩÂíåÂü∫Êú¨ËÆ
             -°Êï∞Âô®‰∏äÊ∫¢‰ΩøËÉΩ
 139   1        SetBit(TIM3_CR0, T3IRE );                                 // ËæìÂÖ•ÊúâÊïàËæπÊ≤øÂèòÂåñ‰∏≠Êñ≠‰ΩøËÉΩÂíåÂü∫Êú¨ËÆ
             -°Êï∞Âô®‰∏äÊ∫¢‰ΩøËÉΩ
 140   1      /*-------------------------------------------------------------------------------------------------
 141   1        ÂÆöÊó∂Âô®2‰∏≠Êñ≠‰ºòÂÖàÁ∫ßÈÖçÁΩÆÂèäËäØÁâá‰∏≠Êñ≠ÊÄª‰ΩøËÉΩ
 142   1        PTIM31-PTIM30Ôºå‰∏≠Êñ≠‰ºòÂÖàÁ∫ßÊéßÂà∂ÂÄº‰ªé0-3‰æùÊ¨°Ë°®Á§∫‰ºòÂÖàÁ∫ß‰ªéÊúÄ‰ΩéÂà∞ÊúÄÈ´òÔºåÂÖ±4Á∫ß‰ºòÂåñÁ∫ßÊ
             -éßÂà∂
 143   1        EA,ËäØÁâá‰∏≠Êñ≠ÊÄª‰ΩøËÉΩ
 144   1      -------------------------------------------------------------------------------------------------*/
 145   1        PTIM31 = 1;
 146   1        PTIM30 = 0;                                            // TIM2/3‰∏≠Êñ≠‰ºòÂÖàÁ∫ßÂà´‰∏∫2
 147   1        EA = 1;
 148   1      
 149   1      /*-------------------------------------------------------------------------------------------------
 150   1        ÈÖçÁΩÆÂë®ÊúüÂÄº„ÄÅÊØîËæÉÂÄº„ÄÅËÆ°Êï∞ÂÄº
 151   1      -------------------------------------------------------------------------------------------------*/
 152   1        TIM3__CNTR = 1;
 153   1        TIM3__ARR = 6000;
 154   1        TIM3__DR = TIM3__ARR >> 1;  
 155   1        
 156   1        
 157   1      /*-----------ÂÖ≥Èó≠ËÆ°Êï∞------------------------------------------------*/
 158   1        ClrBit(TIM3_CR1, T3EN);           //ÂÖ≥Èó≠ËÆ°Êï∞Âô®
 159   1        
 160   1      }
 161          
 162          /*-------------------------------------------------------------------------------------------------
 163            Function Name : void TIM4_Init(void)
 164            Description   : TIM4ÂàùÂßãÂåñÈÖçÁΩÆÔºåÁî®‰∫éÂ§ÑÁêÜÂ∏∏ËßÑ‰∫ãÂä°ÔºåÂ¶ÇÁéØË∑ØÂìçÂ∫îÔºåÊïÖÈöú‰øùÊä§Á≠â
 165            Input         : Êó†
 166            Output        : Êó†
 167          -------------------------------------------------------------------------------------------------*/
 168          void TIM4_Init(void)
 169          {
 170   1        /*-------------------------------------------------------------------------------------------------
 171   1        ÂÖàÂÅúÊ≠¢ËÆ°Êï∞ÔºåÈÖçÁΩÆÂÆåÂØÑÂ≠òÂô®ÂêéÔºåÊúÄÂêéÂêØÂä®ËÆ°Êï∞
 172   1      -------------------------------------------------------------------------------------------------*/
 173   1        ClrBit(TIM4_CR1, T4EN);       // 0-ÂÅúÊ≠¢ËÆ°Êï∞Ôºõ1-‰ΩøËÉΩËÆ°Êï∞
 174   1      //  SetBit(PH_SEL, T4SEL);        //0-‰∏çËøûÊé•Âà∞Á´ØÂè£GP01Ôºõ1-ËøûÊé•Âà∞Á´ØÂè£GP01
C51 COMPILER V9.52.0.0   TIMERINIT                                                         04/16/2020 10:07:51 PAGE 4   

 175   1      /*-------------------------------------------------------------------------------------------------
 176   1        Êó∂ÈíüÂàÜÈ¢ëËÆæÁΩÆ(T2PSC)
 177   1        000:cpuclk(24MHz)     001:cpuclk/2^1(12MHz) 010:cpuclk/2^2(6MHz)  011:cpuclk/2^3(3MHz)
 178   1        100:cpuclk/2^4(1.5MHz)  101:cpuclk/2^5(750KHz)  110:cpuclk/2^6(375KHz)  111:cpuclk/2^7(187.5KHz)
 179   1      -------------------------------------------------------------------------------------------------*/
 180   1        SetReg(TIM4_CR0, T4PSC0 | T4PSC1, T4PSC0 | T4PSC1);
 181   1      
 182   1      /*-------------------------------------------------------------------------------------------------
 183   1        /Ê®°ÂºèÈÄâÊã©
 184   1        0-ËæìÂÖ•Ê®°Âºè
 185   1        1-ËæìÂá∫Ê®°Âºè
 186   1      -------------------------------------------------------------------------------------------------*/
 187   1        ClrBit(TIM4_CR0, T4MOD);  
 188   1        
 189   1        ClrBit(TIM4_CR0, T4OCM);      //     ÂÆöÊó∂Âô®ÊØîËæÉÂåπÈÖç/ÊçïËé∑ËÑâÂÆΩÊ®°ÂºèÈÖçÁΩÆ
 190   1        
 191   1      /*-------------------------------------------------------------------------------------------------
 192   1        /Êª§Ê≥¢Êó∂Èó¥
 193   1        00-‰∏çÊª§Ê≥¢Ôºõ01-8‰∏™Êó∂ÈíüÂë®Êúü
 194   1        10-16‰∏™Êó∂ÈíüÂë®ÊúüÔºõ11-32‰∏™Êó∂ÈíüÂë®Êúü
 195   1      -------------------------------------------------------------------------------------------------*/
 196   1        SetReg(TIM4_CR1, T4FE1|T4FE0,T4FE0);                               
 197   1      /*-------------------------------------------------------------------------------------------------
 198   1        Ê∏ÖÈô§‰∏≠Êñ≠Ê†áÂøó‰Ωç
 199   1        Á¶ÅÊ≠¢PWMÂë®ÊúüÊ£ÄÊµã‰∏≠Êñ≠‰ΩøËÉΩ
 200   1        ‰ΩøËÉΩËÆ°Êï∞Âô®‰∏äÊ∫¢‰∏≠Êñ≠‰ΩøËÉΩ
 201   1      -------------------------------------------------------------------------------------------------*/
 202   1        ClrBit(TIM4_CR1, T4IR | T4IF | T4IP);                      // Ê∏ÖÈô§‰∏≠Êñ≠Ê†áÂøó‰Ωç
 203   1        ClrBit(TIM4_CR1, T4IPE | T4IFE);                           // ËæìÂÖ•ÊúâÊïàËæπÊ≤øÂèòÂåñ‰∏≠Êñ≠‰ΩøËÉΩÂíåÂü∫Êú¨ËÆ
             -°Êï∞Âô®‰∏äÊ∫¢‰ΩøËÉΩ
 204   1      /*-------------------------------------------------------------------------------------------------
 205   1      
 206   1      
 207   1        ‰∏éTIM1MS‰∏≠Êñ≠‰∏ÄËµ∑ÈÖçÁΩÆ‰ºòÂÖàÁ∫ßÔºå‰øÆÊîπ‰ºòÂÖàÁ∫ßÊó∂Â∫îÊ≥®ÊÑè
 208   1      -------------------------------------------------------------------------------------------------*/
 209   1      //  PTIM4S1 = 0;
 210   1      //  PTIM4S0 = 1;                                       // TIM4/5‰∏≠Êñ≠‰ºòÂÖàÁ∫ßÂà´‰∏∫1
 211   1      //  EA = 1;
 212   1      
 213   1      /*-------------------------------------------------------------------------------------------------
 214   1        ÈÖçÁΩÆÂë®ÊúüÂÄº„ÄÅÊØîËæÉÂÄº„ÄÅËÆ°Êï∞ÂÄº
 215   1      -------------------------------------------------------------------------------------------------*/
 216   1        TIM4__CNTR = 0;  
 217   1        TIM4__ARR = 6000;
 218   1        TIM4__DR = TIM4__ARR >> 1;  
 219   1        
 220   1      /*-----------ÂêØÂä®ËÆ°Êï∞------------------------------------------------*/
 221   1        ClrBit(TIM4_CR1, T4EN);           //‰ΩøËÉΩËÆ°Êï∞Âô®ÔºåÂêØÂä®ËÆ°Êï∞
 222   1      
 223   1      }
 224          
 225          /*-------------------------------------------------------------------------------------------------
 226            Function Name : void TIM1ms_Init(void)
 227            Description   : TIM1MSÂàùÂßãÂåñÈÖçÁΩÆ
 228            Input         : Êó†
 229            Output        : Êó†
 230            Main point    :ÈªòËÆ§‰∏∫1MsÂÆöÊó∂‰∏≠Êñ≠ÔºåÂ¶ÇÈúÄ‰øÆÊîπÂÆöÊó∂‰∏≠Êñ≠ÁöÑÊó∂Èó¥ ÔºöSYS_TICKÈ¢ëÁéá=24M/ÔºàSYS
             -_TICK+1Ôºâ
 231          -------------------------------------------------------------------------------------------------*/
 232          
 233          void TIM1ms_Init(void)
 234          {
C51 COMPILER V9.52.0.0   TIMERINIT                                                         04/16/2020 10:07:51 PAGE 5   

 235   1        //SYST_ARR = 24000;     //ËÆ°ÁÆóÂÖ¨ÂºèÔºö24M/SYST_ARRÔºõ‰æã 24M/24000=1000Hz    SYST_ARR‰∏∫SYS_TICKÁöÑÈáç
             -ËΩΩÂÄº
 236   1        PTIM4S1 = 0;
 237   1        PTIM4S0 = 1;                                       // TIM4/5‰∏≠Êñ≠‰ºòÂÖàÁ∫ßÂà´‰∏∫1
 238   1        EA = 1;
 239   1        SetBit(DRV_SR, SYSTIE, 1);                         // ‰ΩøËÉΩ1msÂÆöÊó∂‰∏≠Êñ≠ ;
 240   1      
 241   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    190    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
