C51 COMPILER V9.52.0.0   DRIVERINIT                                                        04/16/2020 10:07:51 PAGE 1   


C51 COMPILER V9.52.0.0, COMPILATION OF MODULE DRIVERINIT
OBJECT MODULE PLACED IN .\Output\DriverInit.obj
COMPILER INVOKED BY: D:\Keil4\C51\BIN\C51.EXE ..\User\Source\Hardware\DriverInit.c LARGE OMF2 WARNINGLEVEL(0) OPTIMIZE(5
                    -,SPEED) BROWSE INCDIR(..\Library\FU68xx_Hardware_Driver\Include;..\User\Include) DEBUG PRINT(.\Listing\DriverInit.lst) T
                    -ABS(2) OBJECT(.\Output\DriverInit.obj)

line level    source

   1          /**************************** (C) COPYRIGHT 2017 Fortiortech shenzhen *****************************
   2          * File Name          : DriverInit.c
   3          * Author             : Fortiortech  Appliction Team
   4          * Version            : V1.0
   5          * Date               : 10-Apr-2017
   6          * Description        : This file contains driver initial function used for Motor Control.
   7          ***************************************************************************************************
   8          * All Rights Reserved
   9          **************************************************************************************************/
  10          
  11          
  12          /* Includes -------------------------------------------------------------------------------------*/
  13          #include <FU68xx_2.h>
  14          #include <Myproject.h>
  15          
  16          
  17          /*-------------------------------------------------------------------------------------------------
  18            Function Name : void Driver_Init(void)
  19            Description   : DriverÂàùÂßãÂåñÈÖçÁΩÆ
  20            Input         : Êó†
  21            Output        : Êó†
  22          -------------------------------------------------------------------------------------------------*/
  23          void Driver_Init(void)
  24          {
  25   1        /*ÈÖçÁΩÆPWMÂë®ÊúüÂÄºÂíåÊ≠ªÂå∫Êó∂Èó¥*/
  26   1        DRV_ARR       = PWM_VALUE_LOAD;                         // ËΩΩÊ≥¢È¢ëÁéáÁöÑÂë®ÊúüÂÄº
  27   1        DRV_DTR       = PWM_LOAD_DEADTIME;                      // Ê≠ªÂå∫Êó∂Èó¥
  28   1      
  29   1        /*MESEL‰∏∫0ÔºåMEÊ®°ÂùóÂ∑•‰ΩúÂú®BLDCÊ®°Âºè
  30   1          MESEL‰∏∫1ÔºåMEÊ®°ÂùóÂ∑•‰ΩúÂú®FOC/SVPWM/SPWMÊ®°Âºè*/
  31   1        SetBit(DRV_CR, MESEL);
  32   1      
  33   1        /*È©±Âä®ÊúâÊïàÁîµÂπ≥ÂíåÁ©∫Èó≤ÁîµÂπ≥*/
  34   1        #if (PWM_Level_Mode == High_Level)
  35   1        {
  36   2          DRV_CMR &= 0x003f;
  37   2          DRV_OUT &= 0xC0;
  38   2        }
  39   1        #elif (PWM_Level_Mode == Low_Level)
                {
                  DRV_CMR |= 0x0fc0;
                  DRV_OUT = 0x3F;
                }
                #elif (PWM_Level_Mode == UP_H_DOWN_L)
                {
                  DRV_CMR = 0x0540;
                  DRV_OUT = 0x2A;
                }
                #elif (PWM_Level_Mode == UP_L_DOWN_H)
                {
                  DRV_CMR &= 0x0a80;
                  DRV_OUT = 0x15;
                }
C51 COMPILER V9.52.0.0   DRIVERINIT                                                        04/16/2020 10:07:51 PAGE 2   

                #endif //end PWM_Level_Mode
  55   1      
  56   1        /*Ê∏Ö‰∏≠Êñ≠Ê†áÂøó‰ΩçÔºå‰ΩøËÉΩ‰∏≠Êñ≠ÔºåÈÖçÁΩÆÊØîËæÉÂÄºÔºåËÆæÁΩÆ‰∏≠Êñ≠‰ºòÂÖàÁ∫ß*/
  57   1        ClrBit(DRV_SR, DCIF);                                       // Ê∏ÖÈô§DRV‰∏≠Êñ≠Ê†áÂøó‰Ωç
  58   1        /**************************************************
  59   1        DRVÊØîËæÉÂåπÈÖç‰∏≠Êñ≠Ê®°Âºè
  60   1        ÂΩìËÆ°Êï∞ÂÄºÁ≠â‰∫éDRV_COMRÊó∂ÔºåÊ†πÊçÆDCIMÁöÑËÆæÁΩÆÂà§Êñ≠ÊòØÂê¶‰∫ßÁîü‰∏≠Êñ≠Ê†áËÆ∞
  61   1        00Ôºö‰∏ç‰∫ßÁîü‰∏≠Êñ≠
  62   1        01Ôºö‰∏äÂçáÊñπÂêë
  63   1        10Ôºö‰∏ãÈôçÊñπÂêë
  64   1        11Ôºö‰∏äÂçá/‰∏ãÈôçÊñπÂêë
  65   1        *************************************************/
  66   1        SetReg(DRV_SR, DCIM0 | DCIM1, DCIM1);
  67   1        
  68   1        /*ËÆæÁΩÆDRVËÆ°Êï∞Âô®ÁöÑÊØîËæÉÂåπÈÖçÂÄºÔºåÂΩìDRVËÆ°Êï∞ÂÄº‰∏éCOMRÁõ∏Á≠âÊó∂ÔºåÊ†πÊçÆDRV_SRÂØÑÂ≠òÂô®ÁöÑDCIMÊ
             -òØÂê¶‰∫ßÁîüÊØîËæÉÂåπÈÖç‰∫ã‰ª∂*/
  69   1        DRV_COMR =(PWM_VALUE_LOAD>>1);
  70   1        
  71   1        PDRV1 = 1;                                              // ‰∏≠Êñ≠‰ºòÂÖàÁ∫ßËÆæÁΩÆ‰∏∫2Ôºå‰ºòÂÖàÁ∫ß‰Ωé‰∫éFOÁ
             -°¨‰ª∂ËøáÊµÅ
  72   1        PDRV0 = 0;
  73   1        
  74   1        SetBit(DRV_SR, DCIP);                                   // 0--1‰∏™ËΩΩÊ≥¢Âë®ÊúüÊâßË°å‰∏ÄÊ¨°foc‰∏≠Êñ≠Ôºå1--
             -2‰∏™ËΩΩÊ≥¢Âë®ÊúüÊâßË°å‰∏ÄÊ¨°foc‰∏≠Êñ≠
  75   1      
  76   1       /*DRVËÆ°Êï∞Âô®‰ΩøËÉΩÔºå0-Á¶ÅÊ≠¢Ôºå1-‰ΩøËÉΩ*/
  77   1        SetBit(DRV_CR, DRVEN);
  78   1      
  79   1        /*DRVËÆ°Êï∞Âô®ÊØîËæÉÂÄºÈ¢ÑË£ÖËΩΩ‰ΩøËÉΩÔºå0-Á¶ÅÊ≠¢Ôºå1-‰ΩøËÉΩ*/
  80   1        ClrBit(DRV_CR, DRPE);
  81   1      
  82   1       /*Driver ËæìÂá∫‰ΩøËÉΩÔºå0-Á¶ÅÊ≠¢Ôºå1-‰ΩøËÉΩ*/
  83   1        SetBit(DRV_CR, DRVOE);
  84   1      
  85   1      }
  86          
  87          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =     92    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
