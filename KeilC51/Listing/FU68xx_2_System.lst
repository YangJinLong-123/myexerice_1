C51 COMPILER V9.52.0.0   FU68XX_2_SYSTEM                                                   04/08/2020 15:43:41 PAGE 1   


C51 COMPILER V9.52.0.0, COMPILATION OF MODULE FU68XX_2_SYSTEM
OBJECT MODULE PLACED IN .\Output\FU68xx_2_System.obj
COMPILER INVOKED BY: D:\Keil4\C51\BIN\C51.EXE ..\Library\FU68xx_Hardware_Driver\Source\FU68xx_2_System.c LARGE OMF2 WARN
                    -INGLEVEL(0) OPTIMIZE(5,SPEED) BROWSE INCDIR(..\Library\FU68xx_Hardware_Driver\Include;..\User\Include) DEBUG PRINT(.\Lis
                    -ting\FU68xx_2_System.lst) TABS(2) OBJECT(.\Output\FU68xx_2_System.obj)

line level    source

   1          /**************************** (C) COPYRIGHT 2017 Fortiortech shenzhen *****************************
   2          * File Name          : FU68xx_2_System.c
   3          * Author             : Fortiortech  Appliction Team
   4          * Version            : V1.0
   5          * Date               : 10-Apr-2017
   6          * Description        : This file contains the system function used for Motor Control.
   7          ***************************************************************************************************
   8          * All Rights Reserved
   9          **************************************************************************************************/
  10          /* Includes -------------------------------------------------------------------------------------*/
  11          #include <FU68xx_2.h>
  12          
  13          
  14          /*-------------------------------------------------------------------------------------------------
  15              Function Name : VREFConfig(Value, Status)
  16              Description   : å‚è€ƒç”µå‹VREFé…ç½®ï¼Œå¦‚æœä½¿èƒ½VREFæ¨¡å—ï¼Œåˆ™å†…éƒ¨äº§ç”ŸVREFè¾“å…¥åˆ°ADCä½œä¸
             -ºADC
  17                                              å‚è€ƒç”µå‹ï¼Œå¦‚æœç¦æ­¢VREFæ¨¡å—ï¼Œåˆ™ç”±å¤–éƒ¨æä¾›VREFè¾“å…¥åˆ
             -°ADCä½œä¸ºADCå‚è€ƒç”µå‹ã€‚
  18              Input         : Value--VCCä½ç”µå‹é¢„è­¦å€¼
  19                            0: VREF4_5, å‚è€ƒç”µå‹VREFè¾“å‡ºä¸º4.5V
  20                            1: VREF5_0, å‚è€ƒç”µå‹VREFè¾“å‡ºä¸º5.0V
  21                            2: VREF3_0, å‚è€ƒç”µå‹VREFè¾“å‡ºä¸º3.0V
  22                            3: VREF4_0, å‚è€ƒç”µå‹VREFè¾“å‡ºä¸º4.0V
  23                            Statue--ä½¿èƒ½æ§åˆ¶ï¼ŒDisableæˆ–Enableã€‚
  24            Output                :   None
  25          -------------------------------------------------------------------------------------------------*/
  26          void VREFConfig(uint8 Value, bool Status)
  27          {
  28   1          switch(Value)
  29   1          {
  30   2              case 0: ClrBit(VREF_VHALF_CR, VRVSEL0 | VRVSEL1);          break;
  31   2              case 1: SetReg(VREF_VHALF_CR, VRVSEL0 | VRVSEL1, VRVSEL0); break;
  32   2              case 2: SetReg(VREF_VHALF_CR, VRVSEL0 | VRVSEL1, VRVSEL1); break;
  33   2              case 3: SetBit(VREF_VHALF_CR, VRVSEL0 | VRVSEL1);          break;
  34   2          }
  35   1      
  36   1          SetReg(VREF_VHALF_CR, VREFEN, (Status ? VREFEN : 0x00));
  37   1      }
  38          
  39          
  40          /*-------------------------------------------------------------------------------------------------
  41              Function Name : VHALFConfig(Mode, Status)
  42              Description   : åŸºå‡†ç”µå‹VHALFé…ç½®ï¼Œä½¿èƒ½VHALFå·¥ä½œæ¨¡å—ï¼Œé€‰æ‹©VREF/2ä½œä¸ºåŸºå‡†
  43                                              ç”µå‹VHALFè¾“å‡ºï¼ŒVHALFå¯ç”¨ä½œè¿æ”¾åŸºå‡†ç”µå‹ã€‚
  44              Input         : Statue--ä½¿èƒ½æ§åˆ¶ï¼Œ0-Disableæˆ–1-Enableã€‚
  45            Output                :   None
  46          -------------------------------------------------------------------------------------------------*/
  47          void VHALFConfig(bool Status)
  48          {
  49   1          SetReg(VREF_VHALF_CR, VHALFEN, (Status ? VHALFEN : 0x00));
  50   1      }
  51          
C51 COMPILER V9.52.0.0   FU68XX_2_SYSTEM                                                   04/08/2020 15:43:41 PAGE 2   

  52          /* WatchDog Config-------------------------------------------------------------------------------*/
  53          
  54          /*-------------------------------------------------------------------------------------------------
  55              Function Name ï¼šWatchDogConfig(Value ,Status)
  56              Description   ï¼šçœ‹é—¨ç‹—å®šæ—¶å‡½æ•°åˆå§‹åŒ–ï¼Œçœ‹é—¨ç‹—ä½¿èƒ½å’Œå¤ä½ä½¿èƒ½ï¼Œå®šæ—¶é…ç½®
  57              Input         ï¼šValue--å®šæ—¶æ—¶é—´ï¼Œå•ä½msï¼Œæœ€å°å®šæ—¶æ—¶é—´8msï¼Œæœ€å¤§å®šæ—¶1800ms
  58                            Statue--ä½¿èƒ½æ§åˆ¶ï¼ŒDisableæˆ–Enable
  59            Output                ï¼šNone
  60          -------------------------------------------------------------------------------------------------*/
  61          void WatchDogConfig(uint16 Value, bool Status)
  62          {
  63   1          SetReg(CCFG1, WDTEN, (Status ? WDTEN : 0x00));
  64   1          WDT_REL = ((uint16)(65532-(uint32)Value*32768/1000) >> 8);
  65   1          ClrBit(WDT_CR, WDTF);
  66   1          SetBit(WDT_CR, WDTRF);
  67   1      }
  68          
  69          
  70          /*-------------------------------------------------------------------------------------------------
  71              Function Name ï¼šWatchDogRefresh(Value ,Status)
  72              Description   ï¼šåˆ·æ–°çœ‹é—¨ç‹—è®¡æ•°å™¨
  73              Input         ï¼šNone
  74            Output                ï¼šNone
  75          -------------------------------------------------------------------------------------------------*/
  76          void WatchDogRefresh(void)
  77          {
  78   1          SetBit(WDT_CR, WDTRF);
  79   1      }
  80          
  81          /* Flash Program Config--------------------------------------------------------------------------*/
  82          
  83          /*-------------------------------------------------------------------------------------------------
  84              Function Name : uint8 Flash_Sector_Erase(uint8 xdata *FlashAddress)
  85              Description   : æ‰‡åŒºè‡ªæ“¦é™¤: æŒ‡å®šå°†è¦æ“¦é™¤çš„Flashæ‰‡åŒºï¼Œæ¯ä¸ªæ‰‡åŒº128Byteï¼Œå…±128ä¸ªæ‰‡
             -åŒºï¼Œ
  86                                              æ‰‡åŒº0~127å¯¹åº”Flashåœ°å€0x0000~0x3fffï¼Œé€šè¿‡æŒ‡å®šFlashåœ°å€æ¥
             -æŒ‡å®šè¦æ“¦é™¤
  87                                              çš„Flashåœ°å€æ‰€åœ¨æ‰‡åŒºã€‚ä¸€æ¬¡åªèƒ½æ“¦é™¤ä¸€ä¸ªæ‰‡åŒºï¼Œè‡ªæ“¦é™
             -¤æ•°æ®ä¸ºä»»æ„å€¼ï¼Œä¸€å®š
  88                                              è¦åœ¨è§£é”åæ‰ç»™DPTRèµ‹å€¼ã€‚
  89              Input         : FlashAddress--Flashè‡ªæ“¦é™¤æ‰‡åŒºå†…ä»»æ„åœ°å€
  90            Output                :   0--Flashè‡ªæ“¦é™¤æˆåŠŸï¼Œ1--Flashè‡ªæ“¦é™¤å¤±è´¥
  91          -------------------------------------------------------------------------------------------------*/
  92          uint8 Flash_Sector_Erase(uint8 xdata *FlashAddress)
  93          {
  94   1          bool TempEA;
  95   1      
  96   1          TempEA = EA;
  97   1          EA = 0;
  98   1      
  99   1          if(FlashAddress < 0x3f80)       // ä¸æ“¦é™¤æœ€åä¸€ä¸ªæ‰‡åŒº
 100   1          {
 101   2              FLA_CR = 0x03;                                   //ä½¿èƒ½è‡ªæ“¦é™¤
 102   2              FLA_KEY = 0x5a;
 103   2              FLA_KEY = 0x1f;                                   //flashé¢„ç¼–ç¨‹è§£é”
 104   2              _nop_();
 105   2              *FlashAddress = 0xff;                   //å†™ä»»æ„æ•°æ®
 106   2              FLA_CR = 0x08;                                   //å¼€å§‹é¢„ç¼–ç¨‹ï¼Œå®ŒæˆåFlashå†æ¬¡ä¸Šé”
 107   2          }
 108   1      
 109   1          EA = TempEA;
 110   1      
C51 COMPILER V9.52.0.0   FU68XX_2_SYSTEM                                                   04/08/2020 15:43:41 PAGE 3   

 111   1          if(ReadBit(FLA_CR, FLAERR))
 112   1          {
 113   2              return 1;
 114   2          }
 115   1          else
 116   1          {
 117   2              return 0;
 118   2          }
 119   1      }
 120          
 121          /*-------------------------------------------------------------------------------------------------
 122              Function Name : uint8 Flash_Sector_Write(uint8 xdata *FlashAddress, uint8 FlashData)
 123              Description   : Flashè‡ªçƒ§å†™: å¯¹æ‰‡åŒºé¢„ç¼–ç¨‹å’Œè‡ªæ“¦é™¤åï¼Œå¯ä»¥å¯¹æ‰‡åŒºå†…çš„åœ°å€è¿›è¡ŒF
             -lashçƒ§å†™ï¼Œ
 124                            ä¸€æ¬¡çƒ§å†™ä¸€ä¸ªbyte,ä¸€å®šè¦åœ¨è§£é”åæ‰ç»™DPTRèµ‹å€¼
 125              Input         : FlashAddress--Flashçƒ§å†™åœ°å€
 126                                              FlashData--Flashçƒ§å†™æ•°æ®
 127            Output                :   0--Flashè‡ªçƒ§å†™æˆåŠŸï¼Œ1--Flashè‡ªçƒ§å†™å¤±è´¥
 128          -------------------------------------------------------------------------------------------------*/
 129          uint8 Flash_Sector_Write(uint8 xdata *FlashAddress, uint8 FlashData)
 130          {
 131   1          bool TempEA;
 132   1      
 133   1          TempEA = EA;
 134   1          EA = 0;
 135   1      
 136   1        if(FlashAddress < 0x3f80)         // ä¸ç¼–ç¨‹æœ€åä¸€ä¸ªæ‰‡åŒº
 137   1          {
 138   2              FLA_CR = 0x01;              // ä½¿èƒ½Flashç¼–ç¨‹
 139   2              FLA_KEY = 0x5a;
 140   2              FLA_KEY = 0x1f;             // flashé¢„ç¼–ç¨‹è§£é”
 141   2              _nop_();
 142   2              *FlashAddress = FlashData;  // å†™ç¼–ç¨‹æ•°æ®
 143   2              FLA_CR = 0x08;              // å¼€å§‹é¢„ç¼–ç¨‹ï¼Œå®ŒæˆåFlashå†æ¬¡ä¸Šé”
 144   2          }
 145   1      
 146   1          EA = TempEA;
 147   1      
 148   1          if(ReadBit(FLA_CR, FLAERR))
 149   1          {
 150   2              return 1;
 151   2          }
 152   1          else
 153   1          {
 154   2              return 0;
 155   2          }
 156   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    267    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----       5
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.

C51 COMPILER V9.52.0.0   FU68XX_2_SYSTEM                                                   04/08/2020 15:43:41 PAGE 4   


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
