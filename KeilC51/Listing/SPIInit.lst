C51 COMPILER V9.52.0.0   SPIINIT                                                           04/16/2020 10:07:51 PAGE 1   


C51 COMPILER V9.52.0.0, COMPILATION OF MODULE SPIINIT
OBJECT MODULE PLACED IN .\Output\SPIInit.obj
COMPILER INVOKED BY: D:\Keil4\C51\BIN\C51.EXE ..\User\Source\Hardware\SPIInit.c LARGE OMF2 WARNINGLEVEL(0) OPTIMIZE(5,SP
                    -EED) BROWSE INCDIR(..\Library\FU68xx_Hardware_Driver\Include;..\User\Include) DEBUG PRINT(.\Listing\SPIInit.lst) TABS(2)
                    - OBJECT(.\Output\SPIInit.obj)

line level    source

   1          /**************************** (C) COPYRIGHT 2017 Fortiortech shenzhen *****************************
   2          * File Name          : SPIInit.c
   3          * Author             : Fortiortech  Appliction Team
   4          * Version            : V1.0
   5          * Date               : 10-Apr-2017
   6          * Description        : This file contains SPI initial function used for Motor Control.
   7          ***************************************************************************************************
   8          * All Rights Reserved
   9          **************************************************************************************************/
  10          
  11          
  12          /* Includes -------------------------------------------------------------------------------------*/
  13          #include <FU68xx_2.h>
  14          #include <Myproject.h>
  15          
  16          
  17          /*-------------------------------------------------------------------------------------------------
  18            Function Name : void SPI_Init(void)
  19            Description   : SPIåˆå§‹åŒ–é…ç½®
  20            Input         : è¾“å…¥è¯´æ˜Žï¼ˆè¯¦ç»†ï¼‰
  21            Output        : è¾“å‡ºè¯´æ˜Žï¼ˆè¯¦ç»†ï¼‰
  22          -------------------------------------------------------------------------------------------------*/
  23          void SPI_Init(void)
  24          {
  25   1        ClrBit(SPI_CR1, SPIEN);                              // 0,disable SPI;1 enable
  26   1      
  27   1      /*-------------------------------------------------------------------------------------------------
  28   1        SPIç®¡è„šé…ç½®
  29   1        1ã€ç¦æ­¢UARTå¤ç”¨ï¼ŒP06é…ç½®ä¸ºMISOï¼ŒP05é…ç½®ä¸ºMOSI
  30   1        2ã€ç¦æ­¢æ¯”è¾ƒå™¨è¾“å‡ºå¤ç”¨ï¼ŒP07é…ç½®ä¸ºSCLK
  31   1      -------------------------------------------------------------------------------------------------*/
  32   1        ClrBit(PH_SEL, UARTEN);                                // 0,P06 as GPIO or SPI_MISO,P05 as GPIO or SPI_MOSI;1,P0
             -6 and p07 as USART
  33   1      
  34   1      /*-------------------------------------------------------------------------------------------------
  35   1        SPIæ—¶é’Ÿç›¸ä½/æžæ€§é…ç½®
  36   1        CPHA = 0, CPOL = 0:ä¸Šå‡æ²¿æŽ¥æ”¶ï¼Œä¸‹é™æ²¿å‘é€ï¼Œç©ºé—²ç”µå¹³ä¸ºä½Ž
  37   1        CPHA = 0, CPOL = 1:ä¸Šå‡æ²¿å‘é€ï¼Œä¸‹é™æ²¿æŽ¥æ”¶ï¼Œç©ºé—²ç”µå¹³ä¸ºé«˜
  38   1        CPHA = 1, CPOL = 0:ä¸Šå‡æ²¿å‘é€ï¼Œä¸‹é™æ²¿æŽ¥æ”¶ï¼Œç©ºé—²ç”µå¹³ä¸ºä½Ž
  39   1        CPHA = 1, CPOL = 1:ä¸Šå‡æ²¿æŽ¥æ”¶ï¼Œä¸‹é™æ²¿å‘é€ï¼Œç©ºé—²ç”µå¹³ä¸ºé«˜
  40   1      -------------------------------------------------------------------------------------------------*/
  41   1        SetReg(SPI_CR0, CPHA | CPOL, CPOL);
  42   1      /*-------------------------------------------------------------------------------------------------
  43   1        SPIä»Žæ–¹å¼é€‰æ‹©é…ç½®
  44   1        00ï¼š3çº¿ä»Žæ–¹å¼æˆ–3çº¿ä¸»æ–¹å¼ï¼ŒNSSä¿¡å·ä¸è¿žåˆ°ç«¯å£ç®¡è„š
  45   1        01ï¼š4çº¿ä»Žæ–¹å¼æˆ–4çº¿å¤šä¸»æ–¹å¼ï¼ŒNSSé…ç½®ä¸ºè¾“å…¥
  46   1        1xï¼š4çº¿å•ä¸»æ–¹å¼ï¼ŒNSSé…ç½®ä¸ºè¾“å‡ºï¼ŒNSSä¿¡å·è¾“å‡ºxç”µå¹³
  47   1      -------------------------------------------------------------------------------------------------*/
  48   1        SetReg(SPI_CR1, NSSMOD0 | NSSMOD1, NSSMOD0 | NSSMOD1);
  49   1        SetBit(SPI_CR0, SPIMS);                          // 0:Slave, 1:Master
  50   1      
  51   1      /*-------------------------------------------------------------------------------------------------
  52   1        SPIä¸­æ–­é…ç½®
C51 COMPILER V9.52.0.0   SPIINIT                                                           04/16/2020 10:07:51 PAGE 2   

  53   1        SPIFï¼šSPIå­—èŠ‚ä¼ è¾“å®Œæˆä¸­æ–­æ ‡å¿—ï¼Œç¡¬ä»¶ç½®ä½ï¼Œè½¯ä»¶æ¸…é›¶
  54   1        WCOLï¼šSPIå†™å†²çªä¸­æ–­ï¼ˆå‘é€ç¼“å†²å™¨éžç©ºæ—¶å†™æ“ä½œï¼‰ï¼Œç¡¬ä»¶ç½®ä½ï¼Œè½¯ä»¶æ¸…é›¶
  55   1        MODFï¼šSPIæ–¹å¼é”™è¯¯ä¸­æ–­ï¼ˆå¤šä¸»æ–¹å¼NSSè¢«æ‹‰ä½Žï¼ŒMSTENå’ŒSPIENè¢«æ¸…é›¶ï¼‰ç¡¬ä»¶ç½®ä½ï¼Œè½¯ä»¶æ
             -¸…é›¶
  56   1        RXOVRNï¼šSPIæŽ¥æ”¶æº¢å‡ºä¸­æ–­ï¼ˆSPIæŽ¥æ”¶ç¼“å†²å™¨æŽ¥æ”¶æº¢å‡ºï¼‰ï¼Œç¡¬ä»¶ç½®ä½ï¼Œè½¯ä»¶æ¸…é›¶
  57   1      -------------------------------------------------------------------------------------------------*/
  58   1        SetReg(SPI_CR1, SPIIF|WCOL|MODF|RXOVR,0x00);           // SPIæ‰€æœ‰ä¸­æ–­æ¸…é™¤
  59   1      
  60   1        SPIIE = 0;                                             // SPIä¸­æ–­ä½¿èƒ½
  61   1      
  62   1        SPI_CLK = 0;                                           // Fspi = Fcpu / (2*(SPI_CLK + 1)) = 6MHz
  63   1      
  64   1        SetBit(SPI_CR1, SPIEN);                              // enable SPI
  65   1      }
  66          
  67          /*-------------------------------------------------------------------------------------------------
  68            Function Name : void SPI_SendData(uint16 Data, uint8 Channel)
  69            Description   : SPIä¼ è¾“æ•°æ®
  70            Input         : Data--ä¼ è¾“æ•°æ®ï¼Œuint16æ ¼å¼
  71            Output        : Channel--ä¼ è¾“é€šé“ï¼Œå–å€¼0~3
  72          -------------------------------------------------------------------------------------------------*/
  73          void SPI_SendData(uint16 Data, uint8 Channel)
  74          {
  75   1        if(!ReadBit(SPI_CR0, SPIBSY))
  76   1        {
  77   2          Data = Data >> 4 + 0x1000;
  78   2          switch(Channel)
  79   2          {
  80   3            case 0:
  81   3              Data &= 0x3fff;
  82   3              break;
  83   3            case 1:
  84   3              Data |= 0x4000;
  85   3              break;
  86   3            case 2:
  87   3              Data |= 0x8000;
  88   3              break;
  89   3            case 3:
  90   3              Data |= 0xc000;
  91   3              break;
  92   3            default:
  93   3              break;
  94   3          }
  95   2          ClrBit(SPI_CR1, NSSMOD0);
  96   2          SPI_DR = Data>>8;
  97   2          SPI_DR = Data;
  98   2          SetBit(SPI_CR1, NSSMOD0);
  99   2        }
 100   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    144    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
C51 COMPILER V9.52.0.0   SPIINIT                                                           04/16/2020 10:07:51 PAGE 3   

   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
